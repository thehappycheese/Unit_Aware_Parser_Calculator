# Unit Aware Parser / Calculator <!-- omit in toc -->

- [1. Goal](#1-goal)
- [2. Status](#2-status)
- [3. Research Notes (Knuth-Bendix Completion Algorithim)](#3-research-notes-knuth-bendix-completion-algorithim)
- [4. Abstract Syntax Tree Language (ASTL)](#4-abstract-syntax-tree-language-astl)
	- [4.1. Leaf Nodes](#41-leaf-nodes)
		- [4.1.1. Literals](#411-literals)
		- [4.1.2. Symbol](#412-symbol)
	- [4.2. Numeric Operators](#42-numeric-operators)
	- [4.3. Logical Operators](#43-logical-operators)
	- [4.4. Rewrite Rule](#44-rewrite-rule)
	- [4.5. Axiom](#45-axiom)

## 1. Goal

I want to type something like

```text
5V * 50mA = _W
```

Hit enter, and get

``` Watt
0.25W
```

The initial goal is to support various ohms law calculations and then add to it if it feels necessary, but things have gotten a little bit... algebraic.

## 2. Status

Initially I thought "Ok well I'll just implement a 'little bit' of an algebra system, so I don't have to learn some bloated third party library...".
But it turns out, for even simple use cases like the one described above, a substantial algebra system is required.
This project is a trap, a rabbit-hole with no bottom, a portal to the land of hardcore-computer-science.

Not working yet.

## 3. Research Notes (Knuth-Bendix Completion Algorithim)

See my research notes in [readme_extras/](readme_extras/reduction_orderings.md)

## 4. Abstract Syntax Tree Language (ASTL)

The Abstract Syntax Tree Language (ASTL) is used internally to represent:

- Mathematical expressions and equations entered by the user
- Replacement rules used by the internal solver

It looks a bit like lisp `["add", ["num", 1], ["num", 2]]` should evaluate to `["num", 3]`

ASTL is designed with the following goals:

- ASTL statements should be able to be expressed as a javascript or JSON literal.
- Classes are avoided in favour of writing a functional style library.
  - The hope is that this will lead to a library of deliciously composable functions instead of endless copy pasting of class methods and weird inheritance problems
- Forbid variable length function signatures
  - For example  the `[ "add", _, _ ]` function always consists of a list of 3 elements.
- Literals are wrapped in a type function `["num", 5]`.
  - This way the interpreter can be designed to expect only arrays, where the first element specifies type.
  - This (in theory) avoids the nasty javascript pitfalls regarding type checking.

### 4.1. Leaf Nodes

#### 4.1.1. Literals
```javascript
// === Literals: ===
// second argument must be a literal of that type
["num", _]
["bool", _]
["str", _]
```

#### 4.1.2. Symbol

```javascript
// === Symbol: ===
// (Second argument must be a string literal which is the name of a symbol)
["sym", _]

```

### 4.2. Numeric Operators

```javascript
// Addition  (a+b)
["add", a, b]

// Negation  (-a)
["neg", a]

// Multiplication  (a*b)
["mul", a, b]

// Exponentiation  (a^b)
["pow", a, b]
```

### 4.3. Logical Operators

```javascript
// Inversion  (¬a)
["not", a]

// Union  (a∧b)
["and", a, b]

// Disjunction  (a∨b)
["or", a, b]

// Less Than  (a<b)
["lt", a, b]

// Greater Than  (a>b)
["gt", a, b]

// Equal To  (a=b)
// Note: currently this is used both for comparison and to express relationships to be solved.
// This may be changed later for separate operators.
["eq", a, b]

```

### 4.4. Rewrite Rule

```javascript
// Rewrite Rule, a may be replaced with b where c is true
["rew", a, b, c]

```

Rewrite rules may only be applied when:
- c evaluates to ["bool", true] AND
- when a and b are instantiated `tree_is_less_complex_than(instance_a, instance_b)`
  evaluates to `["bool", false]`<br>
  (ie. the instance of b must be simpler than the instance of a)

### 4.5. Axiom

An axiom is simply a rewrite rule preceded by the string expression that was parsed to generate it.
Axioms are not generated by the parser / grammar. I am considering replacing them with a javascript class.

```javascript
["axiom", ["str", _], ["rew", _, _, _]]
```
